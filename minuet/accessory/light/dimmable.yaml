# PACKAGE COLLECTION: MINUET LIGHT ACCESSORY
# VARIANT: PWM DIMMABLE LIGHT
# SUPPORTED HARDWARE: Minuet Light Accessory v3.0
#
# Supports a PWM dimmable light connected to the light accessory board.
# Refer to the light accessory documentation for details.
#
# Variables:
#   - Set `minuet_light_accessory_board_version` according to the silkscreen label
#     printed on your light accessory board, e.g. "v3_0".
defaults:
  minuet_light_accessory_board_version: "unknown"

minuet_light:
  # Dimmable light.
  light:
    - id: minuet_light
      name: "Light"
      platform: monochromatic
      output: minuet_light_pwm
      restore_mode: ALWAYS_OFF
      default_transition_length: 0.5s
      effects:
        - pulse:
      on_state:
        then:
          lambda: |-
            minuet::accessory::light::check_safety_lock();

  # PWM output for driving the PWR pin.
  output:
    - id: minuet_light_pwm
      platform: ledc
      pin:
        number: ${minuet_light_pin_power}
        mode: output
      channel: 0
      frequency: 1000 Hz

  # Shutdown behavior: Turn off the light before ESPHome restarts.
  esphome:
    on_shutdown:
      - priority: 500
        then:
          - lambda: |-
              id(minuet_light_pwm).turn_off();

<<: !include common.yaml
